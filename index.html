<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Business Orbit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Manrope', sans-serif;
      background-color: #070708;
      color: #ffffff;
      overflow-y: auto;
      /* Enable vertical scrolling */
    }

    html {
      overflow-y: auto;
      /* Enable vertical scrolling on html */
    }

    /* Custom Scrollbar for inner containers */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .glass-panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-tab-bar {
      background: rgba(7, 7, 8, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Star Animation */
    @keyframes move-twinkle {
      0% {
        transform: translateY(0);
        opacity: 0.8;
      }

      50% {
        opacity: 0.4;
      }

      100% {
        transform: translateY(-100px);
        opacity: 0.8;
      }
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: move-twinkle 10s linear infinite;
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "framer-motion": "https://esm.sh/framer-motion@^12.29.2",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4"
  }
}
</script>
  <link rel="stylesheet" href="/index.css">

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    window.Telegram.WebApp.ready();
    window.Telegram.WebApp.expand();
    // –¢–≤–æ–π —Ü–≤–µ—Ç Deep Black –∏–∑ –±—Ä–µ–Ω–¥–±—É–∫–∞
    window.Telegram.WebApp.setHeaderColor('#070708'); 
  </script>

  <!-- GUEST MODE: Auto-Switch, Lock Tabs, Custom Modal, CTA Injection -->
  <style>
    /* Locked Tab Styling */
    .locked-tab {
      position: relative;
      filter: grayscale(100%);
      opacity: 0.6;
      pointer-events: none;
    }

    .locked-tab::after {
      content: 'üîí';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 16px;
      z-index: 20;
      pointer-events: none;
    }

    /* Custom Dark Modal */
    .guest-modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 99999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .guest-modal-overlay.active {
      display: flex;
    }

    .guest-modal {
      background: #070708;
      border: 1px solid rgba(16, 152, 247, 0.3);
      border-radius: 20px;
      padding: 32px 24px;
      max-width: 400px;
      width: 100%;
      text-align: center;
      position: relative;
      box-shadow: 0 8px 32px rgba(16, 152, 247, 0.2);
    }

    .guest-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      font-size: 24px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
    }

    .guest-modal-close:hover {
      color: #ffffff;
    }

    .guest-modal-text {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .guest-modal-button {
      display: inline-block;
      padding: 16px 32px;
      background: #1098F7;
      color: #ffffff;
      font-size: 16px;
      font-weight: 600;
      border-radius: 12px;
      text-decoration: none;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-family: 'Manrope', sans-serif;
    }

    .guest-modal-button:hover {
      background: #0d86d9;
      transform: translateY(-2px);
    }
  </style>

  <script>
    (function () {
      'use strict';

      // Check if Guest Mode is active
      const urlParams = new URLSearchParams(window.location.search);
      const isGuestMode = urlParams.get('mode') === 'guest';

      if (!isGuestMode) return;

      console.log('üîí Guest Mode Active');

      // CRITICAL: Skip onboarding automatically for guest users
      // This allows them to see the main app immediately
      try {
        // Create a dummy user state that marks onboarding as complete
        const guestUserState = {
          hasOnboarded: true,
          name: '–ì–æ—Å—Ç—å',
          role: 'owner',
          focus: 'finance'
        };

        // React might be using localStorage or sessionStorage for state persistence
        // We'll inject the completed state before React initializes
        console.log('‚ö° Skipping onboarding for guest mode...');

        // Try to find and click the onboarding buttons automatically - start immediately
        skipOnboarding();
      } catch (error) {
        console.error('Error setting up guest mode:', error);
      }

      function skipOnboarding() {
        // Find and click "–ù–∞—á–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É" button (Welcome screen)
        const startButton = Array.from(document.querySelectorAll('button')).find(el =>
          el.textContent?.includes('–ù–∞—á–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É')
        );

        if (startButton) {
          console.log('‚úÖ Found welcome button, clicking...');
          startButton.click();

          // After clicking, fill the profile form quickly
          setTimeout(fillProfileForm, 150);
        } else {
          // If already past welcome screen, try filling form directly
          fillProfileForm();
        }
      }

      function fillProfileForm() {
        // Find name input field
        const nameInput = document.querySelector('input[type="text"]');

        if (nameInput && !nameInput.value) {
          console.log('‚úÖ Found name input, filling...');
          nameInput.value = '–ì–æ—Å—Ç—å';

          // Trigger React's onChange event
          const event = new Event('input', { bubbles: true });
          nameInput.dispatchEvent(event);

          // Select "–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫" role button - very fast
          setTimeout(() => {
            const roleButtons = Array.from(document.querySelectorAll('button'));
            const ownerButton = roleButtons.find(el => el.textContent?.includes('–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫'));

            if (ownerButton) {
              console.log('‚úÖ Found owner button, clicking...');
              ownerButton.click();
            }

            // Select "–§–∏–Ω–∞–Ω—Å—ã" focus button
            setTimeout(() => {
              const focusButtons = Array.from(document.querySelectorAll('button'));
              const financeButton = focusButtons.find(el => el.textContent?.includes('–§–∏–Ω–∞–Ω—Å—ã'));

              if (financeButton) {
                console.log('‚úÖ Found finance button, clicking...');
                financeButton.click();
              }

              // Click "–ü–æ–µ—Ö–∞–ª–∏" submit button
              setTimeout(() => {
                const submitButton = Array.from(document.querySelectorAll('button')).find(el =>
                  el.textContent?.includes('–ü–æ–µ—Ö–∞–ª–∏')
                );

                if (submitButton) {
                  console.log('‚úÖ Found submit button, clicking...');
                  submitButton.click();

                  // Now initialize guest mode lockdown
                  setTimeout(initGuestMode, 1000);
                } else {
                  // Maybe already completed, try initializing guest mode
                  setTimeout(initGuestMode, 500);
                }
              }, 50);
            }, 50);
          }, 50);
        } else if (nameInput && nameInput.value) {
          // Name already filled, skip to clicking submit
          console.log('‚ÑπÔ∏è Form already filled, checking for submit button...');
          setTimeout(() => {
            const submitButton = Array.from(document.querySelectorAll('button')).find(el =>
              el.textContent?.includes('–ü–æ–µ—Ö–∞–ª–∏')
            );
            if (submitButton) {
              console.log('‚úÖ Clicking submit button...');
              submitButton.click();
              setTimeout(initGuestMode, 800);
            } else {
              // No submit button, maybe already completed
              setTimeout(initGuestMode, 300);
            }
          }, 50);
        } else {
          // Form not found yet, might already be past or loading - try guest mode
          console.log('‚ö†Ô∏è Form not found, initializing guest mode...');
          setTimeout(initGuestMode, 300);
        }
      }

      // Wait for React app to fully render
      let retryCount = 0;
      const maxRetries = 30; // Increased for slower connections

      function initGuestMode() {
        // STEP 1: AUTO-SWITCH TO CALCULATOR (–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
        const toolsTab = Array.from(document.querySelectorAll('button')).find(el =>
          el.textContent?.trim() === '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã'
        );

        if (toolsTab) {
          console.log('‚úÖ Found –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã tab, clicking...');
          setTimeout(() => toolsTab.click(), 200);

          // Re-apply locks after navigation completes
          setTimeout(applyTabLocks, 600);
        } else {
          console.log(`‚ùå –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã tab not found yet (attempt ${retryCount + 1}/${maxRetries})`);
          if (retryCount < maxRetries) {
            retryCount++;
            setTimeout(initGuestMode, 300);
            return;
          } else {
            console.error('‚ö†Ô∏è Failed to find –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã tab after max retries');
          }
        }

        // STEP 2: CREATE CUSTOM MODAL
        createGuestModal();

        // STEP 3: Apply initial locks
        applyTabLocks();
      }

      function applyTabLocks() {
        // Lock tabs: –ì–ª–∞–≤–Ω–∞—è, –ü—Ä–æ–≥—Ä–∞–º–º–∞, –ü—Ä–æ—Ñ–∏–ª—å
        const tabsToLock = ['–ì–ª–∞–≤–Ω–∞—è', '–ü—Ä–æ–≥—Ä–∞–º–º–∞', '–ü—Ä–æ—Ñ–∏–ª—å'];

        tabsToLock.forEach(tabName => {
          const tabElements = Array.from(document.querySelectorAll('button')).filter(el =>
            el.textContent?.trim() === tabName
          );

          tabElements.forEach(tabElement => {
            if (!tabElement.classList.contains('locked-tab')) {
              console.log(`üîí Locking tab: ${tabName}`);
              tabElement.classList.add('locked-tab');

              // Override pointer-events to capture click
              tabElement.style.pointerEvents = 'auto';

              // Remove existing listeners to avoid duplicates
              const newElement = tabElement.cloneNode(true);
              tabElement.parentNode.replaceChild(newElement, tabElement);

              // Add click listener to show modal
              newElement.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                showGuestModal();
              }, true);
            }
          });
        });
      }


      function createGuestModal() {
        // Check if modal already exists
        if (document.getElementById('guestModal')) return;

        const modalHTML = `
          <div id="guestModal" class="guest-modal-overlay">
            <div class="guest-modal">
              <button class="guest-modal-close" onclick="document.getElementById('guestModal').classList.remove('active')">√ó</button>
              <p class="guest-modal-text">üîí –†–∞–∑–¥–µ–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –ë–∏–∑–Ω–µ—Å-–û—Ä–±–∏—Ç—ã</p>
              <a href="https://t.me/BusinessOrbit_Bot" class="guest-modal-button">–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤ Telegram</a>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
      }

      function showGuestModal() {
        const modal = document.getElementById('guestModal');
        if (modal) {
          modal.classList.add('active');
        }
      }


      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(initGuestMode, 1500);
        });
      } else {
        setTimeout(initGuestMode, 1500);
      }

      // Re-apply locks on React navigation changes
      let lockCheckInterval;
      const observer = new MutationObserver(() => {
        const guestModal = document.getElementById('guestModal');
        if (!guestModal) {
          createGuestModal();
        }

        // Re-apply locks periodically to handle React updates
        clearTimeout(lockCheckInterval);
        lockCheckInterval = setTimeout(applyTabLocks, 500);
      });

      observer.observe(document.body, { childList: true, subtree: true });
    })();
  </script>

</head>

<body>
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>

</html>